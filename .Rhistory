zip3_dat=zip3_dat%>%reduce(full_join,by="zip3")%>%mutate(zip3_black_prop=Black/denom_race,
zip3_hisp_prop=Hispanic/denom_race,
zip3_pov_prop=pov_sum/tot_pov_known,
zip3_unins_prop=unins_sum/tot_ins_known,
zip3_prep_density=prepclinics/total_13plus*100000)%>%
dplyr::select(zip3,zip3_black_prop,zip3_hisp_prop,zip3_pov_prop,zip3_unins_prop,zip3_prep_density)
# zip3_dat$zip3_prep_density%>%quantile(.,prob=c(0.333, 0.667),na.rm=TRUE)
# is.na(zip3_dat$zip3_pov_prop)%>%sum()
zipvn=colnames(zip3_dat)[-1]
covar_dat=merge(x=covar_dat,y=zip3_dat,by="zip3",all.x=TRUE)
cat_vars=c("Age_at_init_cat","Primary_payer","Pharmacy_type","Average_copay_cat","Num_protect_interval","Num_protect_interval_cat","Dur_subopt_cat2")
cont_vars=c("Age_at_init","Dur_subopt",zipvn)
DESCRIP.DAT_CAT=data.frame()
for (i in cat_vars){
n=table(covar_dat[[i]],covar_dat$Class)%>%as.data.frame.matrix()
colnames(n)=paste0("N.Mean_G",1:ncol(n))
perc=table(covar_dat[[i]],covar_dat$Class)%>%prop.table(margin=2)%>%as.data.frame.matrix()
colnames(perc)=paste0("Perc.SD_G",1:ncol(perc))
descrip.dat=cbind(n,perc)[,rep(seq_len(ncol(n)),each=2)+c(0,ncol(n))]
descrip.dat=cbind("Var_Name"=rep(i,nrow(n)),"Levels"=1:nrow(n),descrip.dat)
DESCRIP.DAT_CAT=rbind(DESCRIP.DAT_CAT,descrip.dat)
}
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
colnames(DESCRIP.DAT_CONT)=colnames(DESCRIP.DAT_CAT)
DESCRIP.DAT=rbind(DESCRIP.DAT_CAT,DESCRIP.DAT_CONT)
DESCRIP.DAT_rec=DESCRIP.DAT%>%mutate(Category=case_when(Var_Name=="Age_at_init_cat" & Levels==1~"18 to 24",
Var_Name=="Age_at_init_cat" & Levels==2~"25 to 29",
Var_Name=="Age_at_init_cat" & Levels==3~"30 to 39",
Var_Name=="Age_at_init_cat" & Levels==4~"40 to 49",
Var_Name=="Age_at_init_cat" & Levels==5~"50+",
Var_Name=="Primary_payer" & Levels==1~"Commercial",
Var_Name=="Primary_payer" & Levels==2~"Government",
Var_Name=="Primary_payer" & Levels==3~"Cash/Other",
Var_Name=="Pharmacy_type" & Levels==1~"Community-based specialty pharmacy",
Var_Name=="Pharmacy_type" & Levels==2~"Traditional retail pharmacy",
Var_Name=="Average_copay_cat" & Levels==1~"$0",
Var_Name=="Average_copay_cat" & Levels==2~">$0",
Var_Name=="Num_protect_interval_cat" & Levels==1~"1 to 3",
Var_Name=="Num_protect_interval_cat" & Levels==2~"4 to 6",
Var_Name=="Num_protect_interval_cat" & Levels==3~"7 to 9",
Var_Name=="Num_protect_interval_cat" & Levels==4~"10+",
Var_Name=="Dur_subopt_cat2" & Levels==1~"<3 months",
Var_Name=="Dur_subopt_cat2" & Levels==2~"3 to 6 months",
Var_Name=="Dur_subopt_cat2" & Levels==3~"6 to 9 months",
Var_Name=="Dur_subopt_cat2" & Levels==4~"9 to 12 months",
Var_Name=="Dur_subopt_cat2" & Levels==5~"12 to 15 months",
Var_Name=="Dur_subopt_cat2" & Levels==6~"15 to 18 months",
Var_Name=="Dur_subopt_cat2" & Levels==7~"18 to 21 months",
Var_Name=="Dur_subopt_cat2" & Levels==8~"21 to 24 months"))
DESCRIP.DAT_rec$Category[which(DESCRIP.DAT_rec$Var_Name=="Num_protect_interval")]=DESCRIP.DAT_rec$Levels[which(DESCRIP.DAT_rec$Var_Name=="Num_protect_interval")]
DESCRIP.DAT_rec=DESCRIP.DAT_rec%>%dplyr::select(Var_Name,Category,N.Mean_G1,Perc.SD_G1,N.Mean_G2,Perc.SD_G2,N.Mean_G3,Perc.SD_G3,N.Mean_G4,Perc.SD_G4)
DESCRIP.DAT_rec
covar_dat%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x)))
)
covar_dat
cont_vars
covar_dat%>%group_by(cat_vars,Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
cat_vars
covar_dat%>%dplyr::select(cat_vars,Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
nmiss_cat
nmiss_cont
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%t()
nused_cat
covar_dat$Class%>%table()
DESCRIP.DAT_CAT
rep(seq_len(ncol(n)),each=2)+c(0,ncol(n))
cbind(nused_cat,nmiss_cat,DESCRIP.DAT_CAT)
nmiss_cat
DESCRIP.DAT_CAT
merge(DESCRIP.DAT_CAT,nmiss,by="Var_Name")
merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name")
merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)
nmiss_cat
nmiss_cat$Var_Name=row.names(nmiss_cat)
row.names(nmiss_cat)
rownames(nmiss_cat)
rowname(nmiss_cat)
row.names(nmiss_cat)
nmiss_cat
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
nmiss_cat
row.names(nmiss_cat)
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
nmiss_cat$Var_Name=row.names(nmiss_cat)
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()
nmiss_cat
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()%>%data.frame()
nmiss_cat
nmiss_cat$Var_Name=row.names(nmiss_cat)
nmiss_cat
nused_cat$Var_Name=row.names(nmiss_cat)
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%t()%>%data.frame()
nmiss_cat$Var_Name=row.names(nmiss_cat)
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%t()%>%data.frame()
nused_cat$Var_Name=row.names(nmiss_cat)
merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)
colnames(nmiss_cat)
colnames(nmiss_cat)[1:4]=paste0("NMiss_G",1:4)
nmiss_cat
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cat$Var_Name=row.names(nmiss_cat)
colnames(nmiss_cat)[1:4]=paste0("NMiss_G",1:4)
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cat$Var_Name=row.names(nmiss_cat)
colnames(nused_cat)[1:4]=paste0("Nused_G",1:4)
merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CAT=data.frame()
for (i in cat_vars){
n=table(covar_dat[[i]],covar_dat$Class)%>%as.data.frame.matrix()
colnames(n)=paste0("N.Mean_G",1:ncol(n))
perc=table(covar_dat[[i]],covar_dat$Class)%>%prop.table(margin=2)%>%as.data.frame.matrix()
colnames(perc)=paste0("Perc.SD_G",1:ncol(perc))
descrip.dat=cbind(n,perc)[,rep(seq_len(ncol(n)),each=2)+c(0,ncol(n))]
descrip.dat=cbind("Var_Name"=rep(i,nrow(n)),"Levels"=1:nrow(n),descrip.dat)
DESCRIP.DAT_CAT=rbind(DESCRIP.DAT_CAT,descrip.dat)
}
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cat$Var_Name=row.names(nmiss_cat)
colnames(nmiss_cat)[1:4]=paste0("NMiss_G",1:4)
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cat$Var_Name=row.names(nmiss_cat)
colnames(nused_cat)[1:4]=paste0("Nused_G",1:4)
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nused_cat,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CAT
col.list=c("Var_Name", "Levels",
"Nused_G1","NMiss_G1","N.Mean_G1","Perc.SD_G1",
"Nused_G2","NMiss_G2","N.Mean_G2","Perc.SD_G2",
"Nused_G3","NMiss_G3","N.Mean_G3","Perc.SD_G3",
"Nused_G4","NMiss_G4","N.Mean_G4","Perc.SD_G4")
DESCRIP.DAT_CAT=data.frame()
for (i in cat_vars){
n=table(covar_dat[[i]],covar_dat$Class)%>%as.data.frame.matrix()
colnames(n)=paste0("N.Mean_G",1:ncol(n))
perc=table(covar_dat[[i]],covar_dat$Class)%>%prop.table(margin=2)%>%as.data.frame.matrix()
colnames(perc)=paste0("Perc.SD_G",1:ncol(perc))
descrip.dat=cbind(n,perc)[,rep(seq_len(ncol(n)),each=2)+c(0,ncol(n))]
descrip.dat=cbind("Var_Name"=rep(i,nrow(n)),"Levels"=1:nrow(n),descrip.dat)
DESCRIP.DAT_CAT=rbind(DESCRIP.DAT_CAT,descrip.dat)
}
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cat$Var_Name=row.names(nmiss_cat)
colnames(nmiss_cat)[1:4]=paste0("NMiss_G",1:4)
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cat$Var_Name=row.names(nmiss_cat)
colnames(nused_cat)[1:4]=paste0("Nused_G",1:4)
col.list=c("Var_Name", "Levels",
"Nused_G1","NMiss_G1","N.Mean_G1","Perc.SD_G1",
"Nused_G2","NMiss_G2","N.Mean_G2","Perc.SD_G2",
"Nused_G3","NMiss_G3","N.Mean_G3","Perc.SD_G3",
"Nused_G4","NMiss_G4","N.Mean_G4","Perc.SD_G4")
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nused_cat,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)%>%dplyr::select(col.list)
DESCRIP.DAT_CAT=data.frame()
for (i in cat_vars){
n=table(covar_dat[[i]],covar_dat$Class)%>%as.data.frame.matrix()
colnames(n)=paste0("N.Mean_G",1:ncol(n))
perc=table(covar_dat[[i]],covar_dat$Class)%>%prop.table(margin=2)%>%as.data.frame.matrix()
colnames(perc)=paste0("Perc.SD_G",1:ncol(perc))
descrip.dat=cbind(n,perc)[,rep(seq_len(ncol(n)),each=2)+c(0,ncol(n))]
descrip.dat=cbind("Var_Name"=rep(i,nrow(n)),"Levels"=1:nrow(n),descrip.dat)
DESCRIP.DAT_CAT=rbind(DESCRIP.DAT_CAT,descrip.dat)
}
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cat$Var_Name=row.names(nmiss_cat)
colnames(nmiss_cat)[1:4]=paste0("NMiss_G",1:4)
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cat$Var_Name=row.names(nmiss_cat)
colnames(nused_cat)[1:4]=paste0("Nused_G",1:4)
col.list=c("Var_Name", "Levels",
"Nused_G1","NMiss_G1","N.Mean_G1","Perc.SD_G1",
"Nused_G2","NMiss_G2","N.Mean_G2","Perc.SD_G2",
"Nused_G3","NMiss_G3","N.Mean_G3","Perc.SD_G3",
"Nused_G4","NMiss_G4","N.Mean_G4","Perc.SD_G4")
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nused_cat,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)%>%dplyr::select(all_of(col.list))
DESCRIP.DAT_CAT
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nmiss_cont
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nused_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cont$Var_Name=row.names(nmiss_cont)
colnames(nused_cat)[1:4]=paste0("Nused_G",1:4)
nused_cont
nused_cont
nmiss_cont
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
colnames(DESCRIP.DAT_CONT)=colnames(DESCRIP.DAT_CAT)
colnames(DESCRIP.DAT_CAT)
colnames(DESCRIP.DAT_CONT)
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nused_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cont$Var_Name=row.names(nmiss_cont)
colnames(nused_cont)[1:4]=paste0("Nused_G",1:4)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nused_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nmiss_cont,by="Var_Name",all.x=TRUE)%>%dplyr::select(all_of(col.list))
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nused_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cont$Var_Name=row.names(nmiss_cont)
colnames(nused_cont)[1:4]=paste0("Nused_G",1:4)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nused_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nmiss_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT
mu
## Continuous covariates
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()%>%data.frame()
mu
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()%>%data.frame()
colnames(mu)=paste0("N.Mean_G",1:ncol(n))
mu
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()%>%data.frame()
colnames(mu)=paste0("N.Mean_G",1:ncol(n))
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
colnames(sd)=paste0("Perc.SD_G",1:ncol(n))
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nused_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cont$Var_Name=row.names(nmiss_cont)
colnames(nused_cont)[1:4]=paste0("Nused_G",1:4)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nused_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nmiss_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()%>%data.frame()
colnames(mu)=paste0("N.Mean_G",1:ncol(n))
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
colnames(sd)=paste0("Perc.SD_G",1:ncol(n))
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nused_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cont$Var_Name=row.names(nmiss_cont)
colnames(nused_cont)[1:4]=paste0("Nused_G",1:4)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nused_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nmiss_cont,by="Var_Name",all.x=TRUE)%>%dplyr::select(all_of(col.list))
DESCRIP.DAT_CONT
DESCRIP.DAT=rbind(DESCRIP.DAT_CAT,DESCRIP.DAT_CONT)
DESCRIP.DAT_rec=DESCRIP.DAT%>%mutate(Category=case_when(Var_Name=="Age_at_init_cat" & Levels==1~"18 to 24",
Var_Name=="Age_at_init_cat" & Levels==2~"25 to 29",
Var_Name=="Age_at_init_cat" & Levels==3~"30 to 39",
Var_Name=="Age_at_init_cat" & Levels==4~"40 to 49",
Var_Name=="Age_at_init_cat" & Levels==5~"50+",
Var_Name=="Primary_payer" & Levels==1~"Commercial",
Var_Name=="Primary_payer" & Levels==2~"Government",
Var_Name=="Primary_payer" & Levels==3~"Cash/Other",
Var_Name=="Pharmacy_type" & Levels==1~"Community-based specialty pharmacy",
Var_Name=="Pharmacy_type" & Levels==2~"Traditional retail pharmacy",
Var_Name=="Average_copay_cat" & Levels==1~"$0",
Var_Name=="Average_copay_cat" & Levels==2~">$0",
Var_Name=="Num_protect_interval_cat" & Levels==1~"1 to 3",
Var_Name=="Num_protect_interval_cat" & Levels==2~"4 to 6",
Var_Name=="Num_protect_interval_cat" & Levels==3~"7 to 9",
Var_Name=="Num_protect_interval_cat" & Levels==4~"10+",
Var_Name=="Dur_subopt_cat2" & Levels==1~"<3 months",
Var_Name=="Dur_subopt_cat2" & Levels==2~"3 to 6 months",
Var_Name=="Dur_subopt_cat2" & Levels==3~"6 to 9 months",
Var_Name=="Dur_subopt_cat2" & Levels==4~"9 to 12 months",
Var_Name=="Dur_subopt_cat2" & Levels==5~"12 to 15 months",
Var_Name=="Dur_subopt_cat2" & Levels==6~"15 to 18 months",
Var_Name=="Dur_subopt_cat2" & Levels==7~"18 to 21 months",
Var_Name=="Dur_subopt_cat2" & Levels==8~"21 to 24 months"))
DESCRIP.DAT_rec$Category[which(DESCRIP.DAT_rec$Var_Name=="Num_protect_interval")]=DESCRIP.DAT_rec$Levels[which(DESCRIP.DAT_rec$Var_Name=="Num_protect_interval")]
DESCRIP.DAT_rec
install.packages("ggasym")
library(ggasym)
renv::snapshot()
renv::restore()
swap_cols(DESCRIP.DAT_rec,Levels,Category)
DESCRIP.DAT_rec2=swap_cols(DESCRIP.DAT_rec,Levels,Category)
DESCRIP.DAT_rec2
View(DESCRIP.DAT_rec2)
DESCRIP.DAT_rec2=swap_cols(DESCRIP.DAT_rec,Levels,Category)[,-"Category"]
DESCRIP.DAT_rec2=swap_cols(DESCRIP.DAT_rec,Levels,Category)[,-ncol(DESCRIP.DAT_rec)]
rm(list=ls())
.rs.restartR()
renv::restore()
library(here)
library(tidyverse)
library(lcmm)
library(tidyr)
library(renv)
library(dplyr)
library(rlang)
library(LCTMtools)
library(ellipsis)
library(haven)
library(ggasym)
#Specify user
User="Emory"
if(User=="Emory"){
Folder="fake"
} else{
Folder="real"
}
## Index object for linking original and analysis ID-----------------------------------
sampled_ID_index=read.csv(here("Export",Folder,"Sampled_ID_index.csv"))%>%rename(ID=ID_new)
head(sampled_ID_index)
# Append covariate dataset with predicted group membership ----------------------------------------------------------
mod=readRDS(here("Export",Folder,"GBTM_data4k_rep20maxit10"))
final.mod=mod[[4]]
Pred.Class=sampled_ID_index%>%arrange(ID)
Pred.Class$Class=final.mod$pprob$class
covar=read.csv(here('Data',Folder,'PersonVars_sampled.csv'))%>%rename(ID_orig=ID)
covar_dat=merge(x=covar,y=Pred.Class,by='ID_orig',all.x=TRUE)%>%mutate(Dur_subopt_cat2=case_when(Dur_subopt<13~1,
Dur_subopt<26~2,
Dur_subopt<39~3,
Dur_subopt<52~4,
Dur_subopt<65~5,
Dur_subopt<78~6,
Dur_subopt<91~7,
TRUE~8))
#ZIP-3 covariates -------------------------------------------------------------------------------------------------
fn=list.files(here("Data","ZIP3_Covar"))
zip3_dat=list()
for(i in 1:length(fn)){
zd=read_sas(here("Data","ZIP3_Covar",fn[i]))%>%data.frame()
print(dim(zd))
zip3_dat[[i]]=zd
}
zip3_dat=zip3_dat%>%reduce(full_join,by="zip3")%>%mutate(zip3_black_prop=Black/denom_race,
zip3_hisp_prop=Hispanic/denom_race,
zip3_pov_prop=pov_sum/tot_pov_known,
zip3_unins_prop=unins_sum/tot_ins_known,
zip3_prep_density=prepclinics/total_13plus*100000)%>%
dplyr::select(zip3,zip3_black_prop,zip3_hisp_prop,zip3_pov_prop,zip3_unins_prop,zip3_prep_density)
# zip3_dat$zip3_prep_density%>%quantile(.,prob=c(0.333, 0.667),na.rm=TRUE)
# is.na(zip3_dat$zip3_pov_prop)%>%sum()
zipvn=colnames(zip3_dat)[-1]
covar_dat=merge(x=covar_dat,y=zip3_dat,by="zip3",all.x=TRUE)
#Descriptive statistics by deterministic group membership------------------------------------------------------------
cat_vars=c("Age_at_init_cat","Primary_payer","Pharmacy_type","Average_copay_cat","Num_protect_interval","Num_protect_interval_cat","Dur_subopt_cat2")
cont_vars=c("Age_at_init","Dur_subopt",zipvn)
## Categorical covariates
DESCRIP.DAT_CAT=data.frame()
for (i in cat_vars){
n=table(covar_dat[[i]],covar_dat$Class)%>%as.data.frame.matrix()
colnames(n)=paste0("N.Mean_G",1:ncol(n))
perc=table(covar_dat[[i]],covar_dat$Class)%>%prop.table(margin=2)%>%as.data.frame.matrix()
colnames(perc)=paste0("Perc.SD_G",1:ncol(perc))
descrip.dat=cbind(n,perc)[,rep(seq_len(ncol(n)),each=2)+c(0,ncol(n))]
descrip.dat=cbind("Var_Name"=rep(i,nrow(n)),"Levels"=1:nrow(n),descrip.dat)
DESCRIP.DAT_CAT=rbind(DESCRIP.DAT_CAT,descrip.dat)
}
nmiss_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cat$Var_Name=row.names(nmiss_cat)
colnames(nmiss_cat)[1:4]=paste0("NMiss_G",1:4)
nused_cat=covar_dat%>%dplyr::select(all_of(cat_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cat$Var_Name=row.names(nmiss_cat)
colnames(nused_cat)[1:4]=paste0("Nused_G",1:4)
col.list=c("Var_Name", "Levels",
"Nused_G1","NMiss_G1","N.Mean_G1","Perc.SD_G1",
"Nused_G2","NMiss_G2","N.Mean_G2","Perc.SD_G2",
"Nused_G3","NMiss_G3","N.Mean_G3","Perc.SD_G3",
"Nused_G4","NMiss_G4","N.Mean_G4","Perc.SD_G4")
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nused_cat,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CAT=merge(DESCRIP.DAT_CAT,nmiss_cat,by="Var_Name",all.x=TRUE)%>%dplyr::select(all_of(col.list))
## Continuous covariates
mu=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))%>%t()%>%data.frame()
colnames(mu)=paste0("N.Mean_G",1:ncol(n))
sd=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%group_by(Class)%>%summarise(across(everything(), ~ sd(.x, na.rm = TRUE)))%>%t()
colnames(sd)=paste0("Perc.SD_G",1:ncol(n))
descrip.dat_cont=cbind(mu,sd)[,rep(seq_len(ncol(mu)),each=2)+c(0,ncol(mu))]
DESCRIP.DAT_CONT=data.frame(Var_Name=rownames(descrip.dat_cont)[-1],Levels=NA_real_,descrip.dat_cont[-1,])
row.names(DESCRIP.DAT_CONT)=NULL
nmiss_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(is.na(.x))))%>%
t()%>%data.frame()
nmiss_cont$Var_Name=row.names(nmiss_cont)
colnames(nmiss_cont)[1:4]=paste0("NMiss_G",1:4)
nused_cont=covar_dat%>%dplyr::select(all_of(cont_vars),Class)%>%
group_by(Class)%>%summarise(across(everything(), ~ sum(!is.na(.x))))%>%
t()%>%data.frame()
nused_cont$Var_Name=row.names(nmiss_cont)
colnames(nused_cont)[1:4]=paste0("Nused_G",1:4)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nused_cont,by="Var_Name",all.x=TRUE)
DESCRIP.DAT_CONT=merge(DESCRIP.DAT_CONT,nmiss_cont,by="Var_Name",all.x=TRUE)%>%dplyr::select(all_of(col.list))
##Combine continous and categorical stats
DESCRIP.DAT=rbind(DESCRIP.DAT_CAT,DESCRIP.DAT_CONT)
DESCRIP.DAT_rec=DESCRIP.DAT%>%mutate(Category=case_when(Var_Name=="Age_at_init_cat" & Levels==1~"18 to 24",
Var_Name=="Age_at_init_cat" & Levels==2~"25 to 29",
Var_Name=="Age_at_init_cat" & Levels==3~"30 to 39",
Var_Name=="Age_at_init_cat" & Levels==4~"40 to 49",
Var_Name=="Age_at_init_cat" & Levels==5~"50+",
Var_Name=="Primary_payer" & Levels==1~"Commercial",
Var_Name=="Primary_payer" & Levels==2~"Government",
Var_Name=="Primary_payer" & Levels==3~"Cash/Other",
Var_Name=="Pharmacy_type" & Levels==1~"Community-based specialty pharmacy",
Var_Name=="Pharmacy_type" & Levels==2~"Traditional retail pharmacy",
Var_Name=="Average_copay_cat" & Levels==1~"$0",
Var_Name=="Average_copay_cat" & Levels==2~">$0",
Var_Name=="Num_protect_interval_cat" & Levels==1~"1 to 3",
Var_Name=="Num_protect_interval_cat" & Levels==2~"4 to 6",
Var_Name=="Num_protect_interval_cat" & Levels==3~"7 to 9",
Var_Name=="Num_protect_interval_cat" & Levels==4~"10+",
Var_Name=="Dur_subopt_cat2" & Levels==1~"<3 months",
Var_Name=="Dur_subopt_cat2" & Levels==2~"3 to 6 months",
Var_Name=="Dur_subopt_cat2" & Levels==3~"6 to 9 months",
Var_Name=="Dur_subopt_cat2" & Levels==4~"9 to 12 months",
Var_Name=="Dur_subopt_cat2" & Levels==5~"12 to 15 months",
Var_Name=="Dur_subopt_cat2" & Levels==6~"15 to 18 months",
Var_Name=="Dur_subopt_cat2" & Levels==7~"18 to 21 months",
Var_Name=="Dur_subopt_cat2" & Levels==8~"21 to 24 months"))
DESCRIP.DAT_rec$Category[which(DESCRIP.DAT_rec$Var_Name=="Num_protect_interval")]=DESCRIP.DAT_rec$Levels[which(DESCRIP.DAT_rec$Var_Name=="Num_protect_interval")]
DESCRIP.DAT_final=swap_cols(DESCRIP.DAT_rec,Levels,Category)[,-ncol(DESCRIP.DAT_rec)]
DESCRIP.DAT_final
View(DESCRIP.DAT_final)
rm(list=ls())
library(here)
library(tidyverse)
library(lcmm)
library(tidyr)
library(renv)
library(dplyr)
library(rlang)
library(LCTMtools)
library(ellipsis)
library(haven)
library(ggasym)
#Specify user
User="Emory"
if(User=="Emory"){
Folder="fake"
} else{
Folder="real"
}
## Index object for linking original and analysis ID-----------------------------------
sampled_ID_index=read.csv(here("Export",Folder,"Sampled_ID_index.csv"))%>%rename(ID=ID_new)
head(sampled_ID_index)
#Import input data (long format) --------------------------------------------------------------
SP_long=readRDS(here("Data",Folder,"SP_long_4k"))
head(SP_long)
# Append covariates to the long dataset -----------------------------------------------------
SP_long2=merge(x=SP_long,y=sampled_ID_index,by="ID",all.x=TRUE)
SP_long3=merge(SP_long2,y=covar,by="ID_orig",all.x=TRUE)%>%dplyr::select(ID,Week,Protect,Age_at_init_cat,Average_copay_cat,Primary_payer,Pharmacy_type)%>%arrange(ID)
